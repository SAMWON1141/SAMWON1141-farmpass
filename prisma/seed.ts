import { PrismaClient } from "@prisma/client";
import { devLog } from "../lib/utils/logging/dev-logger";
import { DEFAULT_SYSTEM_SETTINGS } from "../lib/constants/defaults";

const prisma = new PrismaClient();

async function main() {
  // 기존 시스템 설정이 있는지 확인
  const existingSettings = await prisma.system_settings.findFirst();

  if (!existingSettings) {
    // 초기 시스템 설정 생성
    await prisma.system_settings.create({
      data: {
        ...DEFAULT_SYSTEM_SETTINGS,
      },
    });

    devLog.log("✅ 초기 시스템 설정이 생성되었습니다.");
  } else {
    devLog.log("ℹ️ 시스템 설정이 이미 존재합니다.");
  }

  // 약관 초기 데이터 생성
  await createInitialTerms();
}

async function createInitialTerms() {
  const termsData = [
    {
      type: "privacy",
      title: "개인정보처리방침",
      content: `# 개인정보처리방침

## 제1조 (목적)

이 개인정보처리방침은 회사가 제공하는 농장 출입 관리 서비스(FarmPass)와 관련하여 개인정보의 수집, 이용, 제공, 위탁, 파기 등에 관한 사항을 규정함을 목적으로 합니다.

## 제2조 (개인정보의 수집 및 이용목적)

회사는 다음의 목적을 위하여 개인정보를 처리합니다.

1. **서비스 제공**: 농장 출입 관리 서비스 제공
2. **회원 관리**: 회원 가입, 탈퇴, 서비스 이용 기록 관리
3. **고객 지원**: 문의사항 처리 및 고객 지원

## 제3조 (수집하는 개인정보 항목)

회사는 서비스 제공을 위해 다음과 같은 개인정보를 수집합니다.

- **필수항목**: 이름, 이메일, 전화번호
- **선택항목**: 농장 정보, 방문 목적

## 제4조 (개인정보의 보유 및 이용기간)

회사는 원칙적으로 개인정보 수집 및 이용목적이 달성된 후에는 해당 정보를 지체 없이 파기합니다.

## 제5조 (개인정보의 파기절차 및 방법)

회사는 개인정보 보유기간의 경과, 처리목적 달성 등 개인정보가 불필요하게 되었을 때에는 지체없이 해당 개인정보를 파기합니다.

## 제6조 (개인정보의 안전성 확보 조치)

회사는 개인정보보호법 제29조에 따라 다음과 같은 안전성 확보 조치를 취하고 있습니다.

1. 개인정보의 암호화
2. 해킹 등에 대비한 기술적 대책
3. 개인정보에 대한 접근 제한

## 제7조 (개인정보 처리방침 변경)

이 개인정보처리방침은 시행일로부터 적용되며, 법령 및 방침에 따른 변경내용의 추가, 삭제 및 정정이 있는 경우에는 변경사항의 시행 7일 전부터 공지사항을 통하여 고지할 것입니다.`,
      version: "1.0",
      is_active: true,
      is_draft: false,
    },
    {
      type: "privacy_consent",
      title: "개인정보 수집 및 이용",
      content: `# 개인정보 수집 및 이용

## 제1조 (동의 목적)

본 동의는 회사가 제공하는 농장 출입 관리 서비스(FarmPass) 이용을 위해 개인정보 수집 및 이용에 대한 동의를 받기 위한 것입니다.

## 제2조 (수집하는 개인정보 항목)

회사는 서비스 제공을 위해 다음과 같은 개인정보를 수집합니다.

### 필수 수집 항목
- **이름**: 서비스 이용자 식별
- **이메일**: 계정 생성 및 서비스 알림
- **전화번호**: 긴급 상황 시 연락

### 선택 수집 항목
- **농장 정보**: 방문할 농장 관련 정보
- **방문 목적**: 방문 목적 및 관련 정보

## 제3조 (개인정보의 이용목적)

수집된 개인정보는 다음의 목적으로만 이용됩니다.

1. **서비스 제공**: 농장 출입 관리 서비스 제공
2. **회원 관리**: 회원 가입, 탈퇴, 서비스 이용 기록 관리
3. **고객 지원**: 문의사항 처리 및 고객 지원
4. **안전 관리**: 농장 출입 시 안전 관리 및 비상상황 대응

## 제4조 (개인정보의 보유 및 이용기간)

회사는 원칙적으로 개인정보 수집 및 이용목적이 달성된 후에는 해당 정보를 지체 없이 파기합니다.

- **회원 탈퇴 시**: 즉시 파기
- **서비스 이용 종료 시**: 3년 후 자동 파기

## 제5조 (동의 거부권 및 거부 시 불이익)

개인정보 수집 및 이용에 대한 동의를 거부할 수 있습니다. 다만, 동의를 거부할 경우 서비스 이용이 제한됩니다.

## 제6조 (동의 철회)

언제든지 개인정보 수집 및 이용에 대한 동의를 철회할 수 있습니다. 동의 철회 시 서비스 이용이 중단됩니다.

**본인은 위 내용을 충분히 이해하고 개인정보 수집 및 이용에 동의합니다.**`,
      version: "1.0",
      is_active: true,
      is_draft: false,
    },
    {
      type: "terms",
      title: "서비스 이용약관",
      content: `# 서비스 이용약관

## 제1조 (목적)

이 약관은 회사가 제공하는 농장 출입 관리 서비스(FarmPass)의 이용과 관련하여 회사와 이용자 간의 권리, 의무 및 책임사항을 규정함을 목적으로 합니다.

## 제2조 (정의)

1. **서비스**: 회사가 제공하는 농장 출입 관리 서비스
2. **이용자**: 서비스를 이용하는 회원
3. **농장주**: 농장을 소유하거나 관리하는 자
4. **방문자**: 농장을 방문하는 자

## 제3조 (서비스의 제공)

회사는 다음과 같은 서비스를 제공합니다.

1. **농장 등록 및 관리**: 농장 정보 등록 및 관리
2. **방문자 관리**: 방문자 정보 등록 및 관리
3. **출입 기록**: 농장 출입 기록 관리
4. **알림 서비스**: 출입 관련 알림 제공

## 제4조 (서비스 이용)

1. **이용 신청**: 서비스 이용을 원하는 자는 회사가 정한 절차에 따라 이용 신청을 해야 합니다.
2. **이용 승인**: 회사는 이용 신청에 대해 승인 여부를 결정할 수 있습니다.
3. **이용 제한**: 회사는 이용자의 서비스 이용을 제한할 수 있습니다.

## 제5조 (이용자의 의무)

이용자는 다음 사항을 준수해야 합니다.

1. **법령 준수**: 관련 법령 및 이 약관을 준수
2. **정보 제공**: 정확한 정보 제공
3. **서비스 이용**: 서비스를 목적에 맞게 이용
4. **보안 유지**: 계정 정보 보안 유지

## 제6조 (회사의 의무)

회사는 다음 사항을 준수합니다.

1. **서비스 제공**: 안정적인 서비스 제공
2. **개인정보 보호**: 이용자의 개인정보 보호
3. **기술적 보호**: 서비스 보안을 위한 기술적 조치

## 제7조 (책임 제한)

회사는 다음의 경우 책임을 지지 않습니다.

1. 천재지변, 전쟁, 테러 등 불가항력적 사유
2. 이용자의 고의 또는 과실
3. 제3자의 고의 또는 과실

## 제8조 (약관 변경)

회사는 필요한 경우 관련법령을 위배하지 않는 범위에서 이 약관을 변경할 수 있습니다.

## 제9조 (분쟁 해결)

이 약관과 관련된 분쟁은 회사 소재지 관할법원에서 해결합니다.`,
      version: "1.0",
      is_active: true,
      is_draft: false,
    },
    {
      type: "marketing",
      title: "마케팅 정보 수신 동의",
      content: `# 마케팅 정보 수신 동의

## 제1조 (동의 목적)

본 동의는 회사가 제공하는 농장 출입 관리 서비스(FarmPass)와 관련된 마케팅 정보 수신에 대한 동의를 받기 위한 것입니다.

## 제2조 (수신하는 마케팅 정보)

회사는 다음의 마케팅 정보를 제공할 수 있습니다.

1. **서비스 관련 정보**: 새로운 기능, 업데이트, 개선사항
2. **이벤트 정보**: 프로모션, 이벤트, 할인 정보
3. **업계 동향**: 농업 관련 뉴스, 트렌드 정보
4. **교육 자료**: 농장 관리, 방역 관련 교육 자료

## 제3조 (정보 제공 방법)

마케팅 정보는 다음의 방법으로 제공됩니다.

1. **이메일**: 등록된 이메일 주소로 발송
2. **SMS**: 등록된 휴대폰 번호로 발송
3. **앱 푸시**: 모바일 앱을 통한 푸시 알림
4. **웹사이트**: 공지사항, 팝업 등

## 제4조 (수신 거부 및 철회)

1. **수신 거부**: 언제든지 마케팅 정보 수신을 거부할 수 있습니다.
2. **동의 철회**: 동의 철회 시 마케팅 정보 수신이 중단됩니다.
3. **거부 방법**: 
   - 이메일 수신 거부: 이메일 하단의 '수신거부' 링크 클릭
   - SMS 수신 거부: '수신거부' 문자 발송
   - 앱 푸시 거부: 앱 설정에서 알림 비활성화

## 제5조 (동의 거부 시 불이익)

마케팅 정보 수신 동의를 거부하더라도 기본 서비스 이용에는 제한이 없습니다.

## 제6조 (개인정보 보호)

수집된 개인정보는 마케팅 정보 제공 목적으로만 이용되며, 관련 법령에 따라 보호됩니다.

## 제7조 (동의 기간)

마케팅 정보 수신 동의는 회원 탈퇴 또는 동의 철회 시까지 유효합니다.

**본인은 위 내용을 충분히 이해하고 마케팅 정보 수신에 동의합니다.**`,
      version: "1.0",
      is_active: true,
      is_draft: false,
    },
  ];

  for (const termData of termsData) {
    // 해당 타입의 약관이 이미 존재하는지 확인
    const existingTerm = await prisma.terms_management.findFirst({
      where: {
        type: termData.type,
        version: termData.version,
      },
    });

    if (!existingTerm) {
      await prisma.terms_management.create({
        data: termData,
      });
      devLog.log(
        `✅ ${termData.title} (${termData.type}) 초기 데이터가 생성되었습니다.`
      );
    } else {
      devLog.log(`ℹ️ ${termData.title} (${termData.type})이 이미 존재합니다.`);
    }
  }
}

main()
  .catch((e) => {
    devLog.error("❌ 시드 실행 중 오류가 발생했습니다:", e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
